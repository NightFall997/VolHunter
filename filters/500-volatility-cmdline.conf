# filter for cmdline output

# This filter assumes cmdline plugin output was ingested using filebeat
# and the filename was "cmdline-<hostname>.csv".

# Input:
#"Process","PID","CommandLine","Hostname","Investigated"
#"System","4","","DESKTOP-NBVE6KH","false"
#"Registry","120","","DESKTOP-NBVE6KH","false"

filter {

    if [source] =~ /.*\/cmdline.*csv$/  {
        csv {
            source => "message"
            autodetect_column_names => true
            convert => { 
                "PID" => "integer"
                "Investigated" => "boolean"
            }
        }

        mutate {
            rename => {
                "CommandLine" => "command_line"
                "Hostname" => "volhunter_hostname"
                "Investigated" => "investigated"
                "PID" => "pid"
                "Process" => "process_name"
            }
            add_tag => [ "valid-volhunter" ]
        }
    }

}
