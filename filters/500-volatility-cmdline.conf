# filter for cmdline output

# This filter assumes cmdline plugin output was tagged with "volatility_cmdline"
# on ingest.

# Input:
#"Process","PID","CommandLine","Hostname","Investigated"
#"System","4","","DESKTOP-NBVE6KH","false"
#"Registry","120","","DESKTOP-NBVE6KH","false"

# Output:
# {
#               "@version" => "1",
#           "command_line" => "C:\\WINDOWS\\System32\\svchost.exe -k LocalSystemNetworkRestricted -p -s WdiSystemHost",
#           "investigated" => false,
#                "message" => "\"svchost.exe\",\"12892\",\"C:\\WINDOWS\\System32\\svchost.exe -k LocalSystemNetworkRestricted -p -s WdiSystemHost\",\"DESKTOP-NBVE6KH\",\"false\"\r",
#             "@timestamp" => 2019-02-15T03:22:48.968Z,
#     "volhunter_hostname" => "DESKTOP-NBVE6KH",
#                   "host" => "33bfcfe14f05",
#                    "pid" => 12892,
#           "process_name" => "svchost.exe",
#                   "tags" => [
#         [0] "volatility_cmdline"
#     ]
# }

filter {

    if "volatility_cmdline" in [tags] {
        csv {
            source => "message"
            autodetect_column_names => true
            convert => { 
                "PID" => "integer"
                "Investigated" => "boolean"
            }
            add_tag => [ "volatility_cmdline" ]
        }

        mutate {
            rename => {
                "CommandLine" => "command_line"
                "Hostname" => "volhunter_hostname"
                "Investigated" => "investigated"
                "PID" => "pid"
                "Process" => "process_name"
            }
        }
    }

}
